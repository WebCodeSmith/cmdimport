<div class="p-6">
    <div class="mb-6">
        <h1 class="text-2xl font-bold text-slate-900">Precificação de Produtos</h1>
        <p class="text-sm text-slate-600 mt-1">Visão geral do estoque global agrupado por produto.</p>
    </div>

    @if (loading()) {
    <div class="flex items-center justify-center h-64">
        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"></div>
    </div>
    } @else {
    <div class="bg-white border border-slate-200 rounded-lg shadow-sm overflow-hidden">
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-slate-200">
                <thead class="bg-slate-50">
                    <tr>
                        <th scope="col"
                            class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">
                            Produto
                        </th>
                        <th scope="col"
                            class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">
                            Quantidade Total
                        </th>
                        <th scope="col"
                            class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">
                            Preço Médio
                        </th>
                        <th scope="col"
                            class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">
                            Valor Total (Estoque)
                        </th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-slate-200">
                    @for (grupo of produtosAgrupados(); track grupo.nome) {
                    <tr class="hover:bg-slate-50 transition-colors">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-medium text-slate-900">{{ grupo.nome }}</div>
                            <div class="text-xs text-slate-500">{{ grupo.produtos.length }} variações/lotes</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-slate-900 font-semibold">{{ grupo.totalQuantidade }}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-slate-900">{{ formatCurrency(grupo.precoMedio) }}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-slate-900 font-medium text-emerald-600">
                                {{ formatCurrency(grupo.precoMedio * grupo.totalQuantidade) }}
                            </div>
                        </td>
                    </tr>
                    }
                    @if (produtosAgrupados().length === 0) {
                    <tr>
                        <td colspan="4" class="px-6 py-12 text-center text-slate-500">
                            Nenhum produto encontrado.
                        </td>
                    </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
    }
</div>